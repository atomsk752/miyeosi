<!DOCTYPE html>
<html lang="en">


<head>
    <title>Offers</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Travelix Project">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="/styles/bootstrap4/bootstrap.min.css">
    <link href="/plugins/font-awesome-5.6.1/css/all.css">
    <link rel="stylesheet" href="/dist/uikit-3.0.0-rc.25/css/uikit.min.css"/>
    <script src="/dist/uikit-3.0.0-rc.25/js/uikit.min.js"></script>
    <script src="/dist/uikit-3.0.0-rc.25/js/uikit-icons.min.js"></script>
    <script src="js/search.js"></script>
    <link rel="stylesheet" type="text/css" href="/styles/maps_styles.css">
    <link rel="stylesheet" type="text/css" href="/styles/maps_responsive.css">
    <style type="text/css"> html {
        overflow-x: hidden;
        overflow-y: hidden;
    } 
    
    </style>
    <title>maps</title>
</head>
<body>
<div class="super_container">

    <!-- Header -->

    <header class="header">

        <!-- Top Bar -->
        
        <div class="top_bar">
            <div class="container">
                <div class="row">
                    <div class="col d-flex flex-row">
                        <div class="phone">
                            <a href="/index"><img class="phone" src="/images/logo2.jpg"></a>
                        </div>

                        <fieldset class="field-container">
                            <input type="text" placeholder="Insert Title" class="field" />
                            <div class="icons-container">
                                <div class="icon-search"></div>
                                <div class="icon-close">
                                    <div class="x-up"></div>
                                    <div class="x-down"></div>
                                </div>
                            </div>
                        </fieldset>

                        <div class="user_box ml-auto">
                            <a class="glitch-btn" href="/boards/list" target="_self">
                                <div class="text">NEXT</div>
                                <div class="mask">
                                    <span>NEXT</span>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>


    <div class="content_container">
        <div class="wrapper">

            <!--left tab-->

            <div class="left-box">

                <div class="date_tabs_container">
                    <div class="column">
                        <div class="col-lg-12">
                            <div class="date_tabs">
                                <button id="dayBtn1" class="date_tab active">Day1</button>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!--map screen & schedules-->

            <div class="middle-box">
                <div id="map"><h1>MAP PART</h1></div>
                <div class="toggle-nav">
                <span class="e">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </span>
                </div>
                <div class="nav-pane slide-out">
                    <div class="courses">
                        <div class="course box" data-cno="1">
                            <div class="date_detail">
                                <h1>12월 21일 금요일</h1>
                                
                           </div>
                            <ul id="day1" class="sortable droptrue">
                                <li> 
                                    <div class="ui-state-default">
                                        <div>Item1</div>
                                        <div class="delete-bar">
                                           <img src="/images/trash-alt-solid.svg"/>
                                        </div>
                                    </div>    
                                </li>
                                <li> 
                                    <div class="ui-state-default">
                                        <div>Item2</div>
                                        <div class="delete-bar">
                                           <img src="/images/trash-alt-solid.svg"/>
                                        </div>
                                    </div>    
                                </li>
                                <li> 
                                    <div class="ui-state-default">
                                        <div>Item3</div>
                                        <div class="delete-bar">
                                           <img src="/images/trash-alt-solid.svg"/>
                                        </div>
                                    </div>    
                                </li>
                                <li> 
                                    <div class="ui-state-default">
                                        <div>Item4</div>
                                        <div class="delete-bar">
                                           <img src="/images/trash-alt-solid.svg"/>
                                        </div>
                                    </div>    
                                </li>
                            </ul>
                        </div>
                       
                        <div class="course add-bar">
                            <div class="add-icon"></div>
                        </div>
                        <div class="course delete-btn">
                             <img src="/images/trash-alt-solid.svg"/>
                        </div>
                    </div>
                </div>
                <div class="toggle-info">
                    <button>view info</button>
                </div>
                <div class="info-pane slide-out"><h1>info here</h1></div>
            </div>

            <!--sortable course & search tab-->

            <div class="right-box">
                <div class="material-ui tabs">
                    <div class="tab active">TAB1</div>
                    <div class="tab">TAB2</div>
                    <div class="slider"></div>
                </div>
                <div class="tab_content">
                    <div class="course-sort">
                        <ul id="sortable">
                        </ul>
                    </div>
                    <div class="search-tab">
                       <div class="search-win">
                           <input id="tags" type="text" class="search-box"/>

                           <span class="search-button">
                            <span class="search-icon"></span>
                            <input type="hidden" id="search-id">
                            <ul class="search-list">
                               </ul>
                         </span>
                       </div>
                   </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end container -->

</div>


<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="/styles/bootstrap4/popper.js"></script>
<script src="/styles/bootstrap4/bootstrap.min.js"></script>
<script src="/plugins/Isotope/isotope.pkgd.min.js"></script>
<script src="/plugins/easing/easing.js"></script>
<script src="/plugins/parallax-js-master/parallax.min.js"></script>
<script src="/js/maps_custom.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.5.9/firebase.js"></script>

<!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCIdmqOHKEfF4mfn6EXtuLeeP2-h3yJr6A&callback=initMap"></script> -->

<script>
// Initialize Firebase
	var config = {
	  apiKey: "AIzaSyCgzLno3i5zPxKzaE5-9qXrt_FZWCwK8tE",
	  authDomain: "travel-simulator.firebaseapp.com",
	  databaseURL: "https://travel-simulator.firebaseio.com",
	  projectId: "travel-simulator",
	  storageBucket: "travel-simulator.appspot.com",
	  messagingSenderId: "105538800439"
	};
	firebase.initializeApp(config);
	
	var fixedkey= "-LUjJ-spjC4O86R1uwfw";
	var title = "untitled";
	
	var courseObject = {};
	courseObject['day0']= {};
	courseObject['day0']['jsons'] = [];
	courseObject['day0']['markers'] = [];
	courseObject['day0']['li'] = [];
	courseObject.findPoint = function (day, idx){
		
		//console.log("day: " + day);
		//console.log("idx: " + idx);
		
		return {
			json: courseObject["day"+ day]['jsons'][idx], 
			marker: courseObject["day"+day]['markers'][idx], 
			li: courseObject["day"+day]['li'][idx]   };
	};
	
	sortDayList();
	
    function initMap() {
    	
    }
	
    function readCourse(key, title, callback){
    	
    	firebase.database().ref().child('courses/'+key +'/'+ title +'/day1').once("value").then(function(data){
    		
    		var result = data.val();
    		callback(result);
    	});
    	
    };
    
    var map; 
    
    readCourse(fixedkey, title, function(data) {
		console.log("callback.........................");
		for (var i = 0; i < data.length; i++) {
			
			courseObject.day0['jsons'].push(data[i]);
			
			var marker = new google.maps.Marker({
	                position : data[i],
	                title : data[i].title,
	                descs : data[i].descs,
	                myPos : data[i],
	                
	            });
			
			if( i === 0 ){
				map = new google.maps.Map(document.getElementById('map'),{center :{lat:data[i].lat,  lng:data[i].lng} , zoom: 11, minZoom: 10});
			}
			
			marker.setMap(map);
			courseObject['day0']['markers'].push(marker);
			
			var str = "<li data-idx ='"+i+"'>"+ data[i].title + "</li>";			
			courseObject['day0']['li'].push(str);
		
		}
		
		//console.log("1-------------------------------");
		//console.log(courseObject)
		
		readyCourseDiv();
		
    });
    
    function readyCourseDiv(){
    	
    	console.log("readyCourseDiv");
    	
    	var str = "";
    	$(".course.box").each(function(idx, obj){
    		
    		var targetJsons = courseObject['day'+[idx]]['jsons'];
    		
    		var str = "<div class='date_detail'><h1>12월 21일 금요일</h1></div><ul id='day0' class='sortable droptrue'>";
    		
    		for (var i = 0; i < targetJsons.length; i++){
    		
    			str+= "<li data-idx='"+i+"' data-day='"+idx+"'><div class='ui-state-default'><div>"+targetJsons[i].title+"</div><div class='delete-bar'><img src='/images/trash-alt-solid.svg'/></div></div></li>";
    		}
    		
    		str += "</ul>";
    		
    		obj.innerHTML = str;
    		sortDayList();
    		
    	})
    	
    	
    }
	
    
    $('.toggle-nav').on('click', function () {
        toggleNavigation($(this), $('.nav-pane'));
    });
	
    function toggleNavigation(btn, nav) {
        btn.toggleClass('open');
        nav.toggleClass('open');
    }
    
    
    
    function sortDayList() {
    	
    	var originUL;
    	var targetLi; 
    	var targetUL; 
    	
        $( "ul.droptrue" ).sortable({
            connectWith: "ul",
         
	        start: function(event,ui){
	            console.log("start");
	            
	            originUL = $("#" + event.target.id);
	            targetLi = ui.item;
	            
	            
	            
	        },
	    	receive : function(event, ui) {
	    		console.log("receive");
	    		targetUL = $("#" + event.target.id);
	    		console.log("target.......................")
	    		console.log(targetUL.html());
	    		console.log("orgin........................")
	    		console.log(originUL.html());
	    		
	    		refreshCourseObject(targetUL, originUL, targetLi);
	    	}
        });
        $( ".sortable" ).disableSelection();
        
    }
    
    function refreshCourseObject(targetUL, originUL, targetLi){
    	
    	
    	function findULPositionIdx(){
    		
    		var result = -1;
    		
    		targetUL.find("li").each(function(i, obj){
    			
    			var idx = obj.getAttribute("data-idx");
    			
    			console.log('==============================' + i);
    			console.log(idx +"::::::::::::::::::" + targetLi.attr("data-idx"));
    			
    			if(targetLi.attr("data-idx") == idx){
    				console.log("if.................")
    				result = i;
    			}
    		
    		});
    		return result;
    		
    	}
    	
    	
    	var targetDay = courseObject[targetUL.attr("id")];
    	//console.log(targetDay);
    	
    	var originDay = courseObject[originUL.attr("id")];
    	//console.log(originDay);
    	
    	var targetPoint = courseObject.findPoint(targetLi.attr("data-day"), targetLi.attr("data-idx"));
    	//console.log(targetPoint);
    	
    	var targetIndex = findULPositionIdx();
    	
    	courseObject[targetUL.attr("id")].jsons[targetIndex] = targetPoint.json;
    	courseObject[targetUL.attr("id")].markers[targetIndex] = targetPoint.marker;
    	courseObject[targetUL.attr("id")].li[targetIndex] = targetPoint.li;
    	
    	
    	console.log(courseObject);
    	
    	
    	
    	
    }
    
    
    $(".sortable").sortable({
    	update : function() {
    		
    		console.log("sortable....");
    	
    		
    	}
    });
    		

        
     $(".add-bar").on("click", function (e) {
     		
		var idx = $(".course.box").length;
		
		console.log("idx: " + idx);
		
    	var addHtml = "<div class=\"course box\" data-cno='" + idx + "'><div class=\"date_detail\"><h1>12월 22일 토요일</h1>" +
        "</div><ul id='day" + idx + "' class=\"sortable droptrue\"></ul ></div>"

        var btnHtml = "<button id='dayBtn" + idx + "' class=\"date_tab\">Day" + (idx+1) + "</button>";
        
        $(".date_tabs").append(btnHtml);
        $(this).before(addHtml);
        
    	courseObject['day'+ idx]= {};
    	courseObject['day'+ idx]['jsons'] = [];
    	courseObject['day'+ idx]['markers'] = [];
    	courseObject['day'+ idx]['li'] = [];
    	
    	sortDayList();

     });
     
     var field = $('.field');
     
     field.blur(function() {
    	 
     	var newTitle = $(this).val();
     	console.log(newTitle);
     	field.css({"background-color": "#1C63A2", "color" : "white"});
     	field.toggleClass("blurred");
     	field.on("click", function(e){
     		field.css({"background-color": "white", "color" : "black"});
     	});
     	
     		
     	
/*      	firebase.database().ref('/courses/' + fixedkey).child("untitled").update(newTitle);  */
     });

 
   
     
    

</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCIdmqOHKEfF4mfn6EXtuLeeP2-h3yJr6A&callback=initMap"></script>
</body>
</html>